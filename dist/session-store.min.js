var SessionStore=function(t,e,n,a,s){"use strict";function o(t){return t&&"object"==typeof t&&"default"in t?t:{default:t}}var r=o(e),c=o(n),i=o(a),d=o(s);var l={namespaced:!0,state:{cartIsBusy:!0,checkout:null,itemCount:0,drawerIsOpen:!1},getters:{client:(t,e,n)=>c.default.buildClient({domain:n.domain,storefrontAccessToken:n.token})},actions:{async getCheckout({commit:t,dispatch:e,getters:n},a=null){t("setCartIsBusy",!0);const s=a||localStorage.getItem("currentCheckout"),o=s&&"undefined"!==s?await n.client.checkout.fetch(s):await e("createCheckout");t("setCheckout",null==o||null!==o.completedAt?await e("createCheckout"):o),t("setCartIsBusy",!1)},async createCheckout({commit:t,getters:e}){const n=await e.client.checkout.create();return t("setCheckout",n),n},async addLineItemToCheckout({commit:t,dispatch:e,state:n,getters:a},{lineItem:s,quantity:o=1,noteObj:r=null,checkoutObj:c=null}){t("setCartIsBusy",!0),n.checkout||await e("createCheckout");const i=r||{key:"",value:""},d=c||{customAttributes:[{key:"",value:""}]},l=s.id&&s.id.length>15?s.id:btoa(`gid://shopify/ProductVariant/${s.id}`);await a.client.checkout.updateAttributes(n.checkout.id,d);t("setCheckout",await a.client.checkout.addLineItems(n.checkout.id,{variantId:l,quantity:o,customAttributes:[i]})),t("setCartIsBusy",!1)},async updateLineItems({commit:t,state:e,getters:n},a){t("setCartIsBusy",!0);t("setCheckout",await n.client.checkout.updateLineItems(e.checkout.id,a)),t("setCartIsBusy",!1)},async updateAttributes({commit:t,state:e,getters:n},a){t("setCartIsBusy",!0);t("setCheckout",await n.client.checkout.updateAttributes(e.checkout.id,a)),t("setCartIsBusy",!1)},async updateLineItem({dispatch:t},e){t("updateLineItems",[e])},async removeLineItem({state:t,commit:e,getters:n},a){e("setCartIsBusy",!0);e("setCheckout",await n.client.checkout.removeLineItems(t.checkout.id,[a])),e("setCartIsBusy",!1)},async autoOpenDrawer({commit:t,dispatch:e,state:n}){n.drawerIsOpen||(t("setDrawerState",!0),await e("resolveAfter3Seconds"),t("setDrawerState",!1))},resolveAfter3Seconds:async()=>new Promise((t=>{window.setTimeout((()=>{t("resolved")}),3e3)}))},mutations:{setCheckout(t,e){localStorage.setItem("currentCheckout",e.id),r.default.set(t,"checkout",e),t.itemCount=e&&e.lineItems?e.lineItems.reduce(((t,e)=>e.quantity+t),0):0},toggleDrawer(t){t.drawerIsOpen=!t.drawerIsOpen},setDrawerState(t,e){t.drawerIsOpen=e},setCartIsBusy(t,e){t.cartIsBusy=e}}};class u{construct(){}replaceAll(t,e,n){return t.replace(new RegExp(e.replace(/[-\/\\^$*+?.()|[\]{}]/g,"\\$&"),"g"),n)}productsFromHandlesQuery(t){return`{\n\t\t\t${t.map((t=>this.productByHandle(t))).join("")}\n\t\t}`}collectionQuery(t,e,n){return`{ collectionByHandle(handle: "${t}") {\n\t\t\t\t\t${n?"":this.collectionFields()}\n          products(first:${e}${n?`, after: "${n}"`:""}, sortKey: MANUAL) {\n            pageInfo {\n              hasNextPage\n              hasPreviousPage\n            }\n            edges {\n              cursor\n              node {\n                handle\n              }\n            }\n          }\n        }\n      }\n    `}collectionFields(){return"\n      title\n      description\n      image {\n\t\t\t\tsrc\n\t\t\t}\n    "}searchProductsQuery(t,e){return`\n\t\t\t{\n\t\t\t\tproducts(query: "${t}", first: 30 ${e?`, after: "${e}"`:""}) {\n\t\t\t\t\tpageInfo {\n\t\t\t\t\t\thasNextPage,\n\t\t\t\t\t\thasPreviousPage\n\t\t\t\t\t}\n\t\t\t\t\tedges {\n\t\t\t\t\t\tcursor\n\t\t\t\t\t\tnode {\n\t\t\t\t\t\t\t${this._productFragment()}\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t`}queryProduct(t){return`{product: productByHandle(handle: "${t}") {\n\t\t\t${this._productFragment()}\n\t\t}}`}productByHandle(t){return`\n\t\t\t${this.uniqHandle(t)}: productByHandle(handle: "${t}") {\n\t\t\t\t${this._productFragment()}\n\t\t\t}\n\t\t`}uniqHandle(t){return`${t.replace(/-|[0-9]/g,"")}_${Math.random().toString().substring(7)}`}_productFragment(){return'\n\t\t\tavailableForSale\n\t\t\ttitle\n\t\t\thandle\n\t\t\ttags\n\t\t\tdescription\n\t\t\tdescriptionHtml\n\t\t\tproductType\n\t\t\tid\n\n\t\t\timages(first: 10) {\n\t\t\t\tpageInfo {\n\t\t\t\t\thasNextPage\n\t\t\t\t\thasPreviousPage\n\t\t\t\t}\n\t\t\t\tedges {\n\t\t\t\t\tnode {\n\t\t\t\t\t\tsrc\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tmetafields(identifiers:\n\t\t\t\t[\n\t\t\t\t\t{ namespace: "pdp_extras", key: "pdp_swatch_name" },\n\t\t\t\t\t{ namespace: "pdp_extras", key: "pdp_swatch_products" },\n\t\t\t\t\t{ namespace: "pdp_extras", key: "pdp_swatch_hex" },\n\t\t\t\t\t{ namespace: "pdp_extras", key: "pdp_field_details" },\n\t\t\t\t\t{ namespace: "pdp_extras", key: "pdp_similar_products" }\n\t\t\t\t]\n\t\t\t){\n\t\t\t\tkey\n\t\t\t\tvalue\n\t\t\t}\n\n\t\t\tmedia(first: 5) {\n\t\t\t\tedges{\n\t\t\t\t\tnode {\n\t\t\t\t\t\talt\n\t\t\t\t\t\tmediaContentType\n\t\t\t\t\t\t... on Video {\n              id\n              sources {\n                format\n                height\n                mimeType\n                url\n                width\n              }\n            }\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tvariants(first: 40) {\n\t\t\t\tpageInfo {\n\t\t\t\t\thasNextPage\n\t\t\t\t\thasPreviousPage\n\t\t\t\t}\n\t\t\t\tedges {\n\t\t\t\t\tnode {\n\t\t\t\t\t\tid\n\t\t\t\t\t\tavailableForSale\n\t\t\t\t\t\tcompareAtPrice {\n\t\t\t\t\t\t\tamount\n\t\t\t\t\t\t}\n\t\t\t\t\t\tprice {\n\t\t\t\t\t\t\tamount\n\t\t\t\t\t\t}\n\t\t\t\t\t\ttitle\n            image {\n              src\n            }\n\t\t\t\t\t\tselectedOptions {\n\t\t\t\t\t\t\tvalue,\n\t\t\t\t\t\t\tname\n\n\t\t\t\t\t\t}\n            swatch_color: metafield(\n              namespace: "pdp_extras"\n              key: "swatch_color"\n            ) {\n                value\n            }\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t'}}class p{constructor({shopifyDomain:t,shopifyToken:e}){this.shopifyDomain=t,this.shopifyToken=e,this.graphSql=new u}fetch(t){const e={method:"POST",headers:{"content-type":"application/graphql","X-Shopify-Storefront-Access-Token":this.shopifyToken},url:`https://${this.shopifyDomain}/api/2023-01/graphql.json`,data:t};return i.default(e)}fetchCollection(t,e,n=50,a=1){const s=this.graphSql.collectionQuery(t,n,e);return this.fetch(s).then((t=>{const e=t.data.data.collectionByHandle;if(!e)return;const n=this._normalizeGraphqlResponse(e.products);return{...e,products:n.content.map((t=>t.handle)),nextPage:n.cursor}})).catch((t=>{console.log(`fetchCollection error: ${t}`)}))}filterAvailableAndStocked(t){return t.variants.some((t=>t.available))||t.tags.includes("restocking")}fetchProduct(t){let e=this.graphSql.queryProduct(t);return this.fetch(e).then((t=>this._normalizeGraphqlProduct(t.data.data.product)))}fetchProductsFromHandles(t){if(t&&t.length>0){const e=this.graphSql.productsFromHandlesQuery(t);return this.fetch(e).then((t=>{const e=t.data.data;return e?Object.values(e).map((t=>t?this._normalizeGraphqlProduct(t):"Stale")):[]}))}return[]}_normalizeGraphqlResponse(t){const e=!!t.hasOwnProperty("pageInfo")&&t.pageInfo.hasNextPage;return{hasNextPage:e,cursor:e?t.edges[t.edges.length-1].cursor:"",content:t.edges.map((t=>t.node))}}_normalizeGraphqlProduct(t,e){return{...t,manualSortWeight:e,images:this._normalizeGraphqlResponse(t.images).content,metafields:this._mapMetafieldsArrayToObj(t.metafields),variants:this._normalizeGraphqlResponse(t.variants).content,media:this._normalizeGraphqlResponse(t.media)}}_mapMetafieldsArrayToObj(t){return t.filter((t=>null!==t)).reduce(((t,e)=>{if(e)return t[e.key]=e.value,t}),{})}}const h=(t,e)=>{e.forEach((e=>{if(e.isCollection){const{products:n,title:a,productCount:s,url:o}=e,r=o.replace("/collections/","");t("products/updateCollection",{handle:r,collectionResponse:{products:n,title:a,handle:r,partiallyLoaded:e.products.length<s}},{root:!0}),e.products.length>=s&&t("products/markCollectionAsFullyLoaded",r,{root:!0})}e.links&&h(t,e.links)}))},m=(t,e)=>{var n;t("products/pushToProducts",(n=e.reduce(((t,e)=>[...t,..."object"==typeof e.products?e.products:[],...e.links?e.links.reduce(((t,e)=>"object"==typeof e.products?[...t,...e.products]:t),[]):[]]),[]),[...new Set(n)]),{root:!0})};const g={cart:l,products:{namespaced:!0,state:{collections:{},allProducts:{},isLoading:!1,loadedCollections:[]},getters:{apiClient:(t,e,n)=>new p({shopifyDomain:n.domain,shopifyToken:n.token})},actions:{async getCollection({state:t,dispatch:e},n){await e("getCollectionProducts",n)},async getCollectionProducts({dispatch:t,commit:e},n){e("setIsLoading",!0),await t("getCollectionProductPage",{handle:n,cursor:null,page:1}),e("setIsLoading",!1),e("markCollectionAsFullyLoaded",n)},async getCollectionProductPage({dispatch:t,commit:e,getters:n},{handle:a,cursor:s,page:o}){const r=await n.apiClient.fetchCollection(a,s,s?250:50,o);r?(e("pushToProducts",r.products),e("updateCollection",{handle:a,collectionResponse:r}),r.nextPage&&await t("getCollectionProductPage",{handle:a,cursor:r.nextPage,page:o+1})):console.log(`Collection not found for handle: ${a}`)},async getProduct({state:t,dispatch:e,commit:n,getters:a},s){let o=t.allProducts[s];if((!o||o&&!o.meta)&&(n("setIsLoading",!0),n("updateProductsLoadingState",{handle:s,loadingState:{isLoaded:!1,isLoading:!0}}),o=await a.apiClient.fetchProduct(s),n("pushToProducts",[o]),n("setIsLoading",!1)),o.metafields){e("getProductsByHandle",[...o.metafields.pdp_swatch_products?o.metafields.pdp_swatch_products.split(","):[],...o.metafields.pdp_similar_products?o.metafields.pdp_similar_products.split(","):[]])}},async getProductsByHandle({state:t,commit:e,getters:n},a=[]){const s=a.filter((e=>!t.allProducts[e]||!t.allProducts[e].isLoaded));e("pushToProducts",await n.apiClient.fetchProductsFromHandles(s))}},mutations:{setIsLoading(t,e){t.isLoading=e},markCollectionAsFullyLoaded(t,e){t.loadedCollections=[...t.loadedCollections,e]},updateCollection(t,{handle:e,collectionResponse:n}){const a=t.collections[e],s=a&&a.partiallyLoaded?a:n;var o;a&&t.collections[e].products&&n.products&&a.partiallyLoaded&&(s.products=(o=[...a.products,...n.products],[...new Set(o)])),r.default.set(t.collections,e,s)},pushToProducts(t,e){e.forEach((e=>{if("Stale"===e)return;const n="string"==typeof e,a=n?e:e.handle,s={...n?{handle:a}:e,isLoading:!1,isLoaded:!n};r.default.set(t.allProducts,a,s)}))},updateProductsLoadingState(t,{handle:e,loadingState:n}){r.default.set(t.allProducts,e,{...t.allProducts[e],...n})}}},menu:{namespaced:!0,state:()=>({items:{},menuHasClosed:!1,menuIsOpen:!1}),actions:{async fetchMenu({commit:t,rootState:e}){const n=await i.default({method:"GET",url:e.menuLocation}),a=n.data&&n.data.menu?n.data.menu:[];t("setMenu",a),m(t,a),h(t,a)}},mutations:{setMenu(t,e){t.items=e},setError(t,e){t.menu=e},toggleMenu(t){t.menuIsOpen=!t.menuIsOpen}}}};return t.CreateStore=(t,e)=>new d.default.store({getters:{domain:t,token:e},modules:g,strict:!1}),t.Modules=g,Object.defineProperty(t,"__esModule",{value:!0}),t}({},Vue,ShopifyBuyClient,axios,vuex);