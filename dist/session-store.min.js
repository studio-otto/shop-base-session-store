var SessionStore=function(t,e,n,s,a){"use strict";function o(t){return t&&"object"==typeof t&&"default"in t?t:{default:t}}var r=o(e),c=o(n),i=o(s),l=o(a);var d={namespaced:!0,state:{cartIsBusy:!0,checkout:null,itemCount:0,drawerIsOpen:!1},getters:{client:(t,e,n)=>c.default.buildClient({domain:n.domain,storefrontAccessToken:n.token})},actions:{async getCheckout({commit:t,dispatch:e,getters:n},s=null){t("setCartIsBusy",!0);const a=s||localStorage.getItem("currentCheckout");t("setCheckout",a&&"undefined"!==a?await n.client.checkout.fetch(a):await e("createCheckout")),t("setCartIsBusy",!1)},async createCheckout({commit:t,getters:e}){const n=await e.client.checkout.create();return t("setCheckout",n),n},async addLineItemToCheckout({commit:t,dispatch:e,state:n,getters:s},{lineItem:a,quantity:o=1,noteObj:r=null,checkoutObj:c=null}){t("setCartIsBusy",!0),n.checkout||await e("createCheckout");const i=r||{key:"",value:""},l=c||{customAttributes:[{key:"",value:""}]},d=a.id&&a.id.length>15?a.id:btoa("gid://shopify/ProductVariant/"+a.id);await s.client.checkout.updateAttributes(n.checkout.id,l);t("setCheckout",await s.client.checkout.addLineItems(n.checkout.id,{variantId:d,quantity:o,customAttributes:[i]})),t("setCartIsBusy",!1),e("autoOpenDrawer")},async updateLineItems({commit:t,state:e,getters:n},s){t("setCartIsBusy",!0);t("setCheckout",await n.client.checkout.updateLineItems(e.checkout.id,s)),t("setCartIsBusy",!1)},async updateAttributes({commit:t,state:e,getters:n},s){t("setCartIsBusy",!0);t("setCheckout",await n.client.checkout.updateAttributes(e.checkout.id,s)),t("setCartIsBusy",!1)},async updateLineItem({dispatch:t},{lineItemId:e,quantity:n}){t("updateLineItems",[{id:e,quantity:n}])},async removeLineItem({state:t,commit:e,getters:n},s){e("setCartIsBusy",!0);e("setCheckout",await n.client.checkout.removeLineItems(t.checkout.id,[s])),e("setCartIsBusy",!1)},async autoOpenDrawer({commit:t,dispatch:e,state:n}){n.drawerIsOpen||(t("setDrawerState",!0),await e("resolveAfter3Seconds"),t("setDrawerState",!1))},resolveAfter3Seconds:async()=>new Promise(t=>{window.setTimeout(()=>{t("resolved")},3e3)})},mutations:{setCheckout(t,e){localStorage.setItem("currentCheckout",e.id),r.default.set(t,"checkout",e),t.itemCount=e&&e.lineItems?e.lineItems.reduce((t,e)=>e.quantity+t,0):0},toggleDrawer(t){t.drawerIsOpen=!t.drawerIsOpen},setDrawerState(t,e){t.drawerIsOpen=e},setCartIsBusy(t,e){t.cartIsBusy=e}}};class u{construct(){}replaceAll(t,e,n){return t.replace(new RegExp(e.replace(/[-\/\\^$*+?.()|[\]{}]/g,"\\$&"),"g"),n)}productsFromHandlesQuery(t){return`{\n\t\t\t${t.map(t=>this.productByHandle(t)).join("")}\n\t\t}`}collectionQuery(t,e,n){return`{ collectionByHandle(handle: "${t}") {\n\t\t\t\t\t${n?"":this.collectionFields()}\n          products(first:${e}${n?`, after: "${n}"`:""}, sortKey: MANUAL) {\t\t\t\t\t\t\n            pageInfo {\n              hasNextPage\n              hasPreviousPage\n            }\n            edges {\n              cursor\n              node {\n                ${this._productFragment()}\n              }\n            }\n          }\n        }\n      }\n    `}collectionFields(){return"\n      title\n      description\n      image {\n\t\t\t\tsrc\n\t\t\t}\n    "}searchProductsQuery(t,e){return`\n\t\t\t{\n\t\t\t\tproducts(query: "${t}", first: 30 ${e?`, after: "${e}"`:""}) {\n\t\t\t\t\tpageInfo {\n\t\t\t\t\t\thasNextPage,\n\t\t\t\t\t\thasPreviousPage\n\t\t\t\t\t}\n\t\t\t\t\tedges {\n\t\t\t\t\t\tcursor\n\t\t\t\t\t\tnode {\n\t\t\t\t\t\t\t${this._productFragment()}\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t`}queryProduct(t){return`{product: productByHandle(handle: "${t}") {\n\t\t\t${this._productFragment()}\n\t\t}}`}productByHandle(t){return`\n\t\t\t${this.uniqHandle(t)}: productByHandle(handle: "${t}") {\n\t\t\t\t${this._productFragment()}\n\t\t\t}\n\t\t`}uniqHandle(t){return`${t.replace(/-|[0-9]/g,"")}_${Math.random().toString().substring(7)}`}_productFragment(){return'\n\t\t\tavailableForSale\n\t\t\ttitle\n\t\t\thandle\n\t\t\ttags\n\t\t\tdescription\n\t\t\tdescriptionHtml\n\t\t\tproductType\n\t\t\tid\n\t\n\t\t\timages(first: 10) {\n\t\t\t\tpageInfo {\n\t\t\t\t\thasNextPage\n\t\t\t\t\thasPreviousPage\n\t\t\t\t}\n\t\t\t\tedges {\n\t\t\t\t\tnode {\n\t\t\t\t\t\tsrc\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\n\t\t\tmetafields(first: 50, namespace: "pdp_extras") {\n\t\t\t\tedges {\n\t\t\t\t\tnode {\n\t\t\t\t\t\tkey\n\t\t\t\t\t\tvalue\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\n\t\t\tvariants(first: 20) {\n\t\t\t\tpageInfo {\n\t\t\t\t\thasNextPage\n\t\t\t\t\thasPreviousPage\n\t\t\t\t}\n\t\t\t\tedges {\n\t\t\t\t\tnode {\n\t\t\t\t\t\tid\n\t\t\t\t\t\tavailable\n\t\t\t\t\t\tcompareAtPrice\n\t\t\t\t\t\tprice\n\t\t\t\t\t\ttitle\n\t\t\t\t\t\tselectedOptions {\n\t\t\t\t\t\t\tvalue\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t'}}class h{constructor({shopifyDomain:t,shopifyToken:e}){this.shopifyDomain=t,this.shopifyToken=e,this.graphSql=new u}fetch(t){const e={method:"POST",headers:{"content-type":"application/graphql","X-Shopify-Storefront-Access-Token":this.shopifyToken},url:`https://${this.shopifyDomain}/api/2020-01/graphql.json`,data:t};return i.default(e)}fetchCollection(t,e,n=50,s=1){const a=this.graphSql.collectionQuery(t,n,e);return this.fetch(a).then(t=>{const e=t.data.data.collectionByHandle;if(!e)return;const a=this._normalizeGraphqlResponse(e.products);return{...e,products:a.content.map((t,e)=>this._normalizeGraphqlProduct(t,e+s*n)).filter(this.filterAvailableAndStocked),nextPage:a.cursor}}).catch(t=>{console.log("fetchCollection error: "+t)})}filterAvailableAndStocked(t){return t.variants.some(t=>t.available)||t.tags.includes("restocking")}fetchProduct(t){let e=this.graphSql.queryProduct(t);return this.fetch(e).then(t=>this._normalizeGraphqlProduct(t.data.data.product))}fetchProductsFromHandles(t){if(t&&t.length>0){const e=this.graphSql.productsFromHandlesQuery(t);return this.fetch(e).then(t=>{const e=t.data.data;return e?Object.values(e).map(t=>t?this._normalizeGraphqlProduct(t):"Stale"):[]})}return[]}_normalizeGraphqlResponse(t){const e=!!t.hasOwnProperty("pageInfo")&&t.pageInfo.hasNextPage;return{hasNextPage:e,cursor:e?t.edges[t.edges.length-1].cursor:"",content:t.edges.map(t=>t.node)}}_normalizeGraphqlProduct(t,e){return{...t,manualSortWeight:e,images:this._normalizeGraphqlResponse(t.images).content,metafields:this._mapMetafieldsArrayToObj(this._normalizeGraphqlResponse(t.metafields).content),variants:this._normalizeGraphqlResponse(t.variants).content}}_mapMetafieldsArrayToObj(t){return t.reduce((t,e)=>(t[e.key]=e.value,t),{})}}const p={cart:d,products:{namespaced:!0,state:{collections:{},allProducts:{},isLoading:!1,loadedCollections:[]},getters:{apiClient:(t,e,n)=>new h({shopifyDomain:n.domain,shopifyToken:n.token})},actions:{async getCollection({state:t,dispatch:e},n){t.collections[n]&&t.collections[n].products||await e("getCollectionProducts",n)},async getCollectionProducts({dispatch:t,commit:e},n){e("setIsLoading",!0),await t("getCollectionProductPage",{handle:n,cursor:null,page:1}),e("setIsLoading",!1),e("markCollectionAsFullyLoaded",n)},async getCollectionProductPage({dispatch:t,commit:e,getters:n},{handle:s,cursor:a,page:o}){const r=await n.apiClient.fetchCollection(s,a,a?20:6,o);r?(e("addCollectionProducts",{handle:s,collectionResponse:r}),r.products&&e("pushToAllProducts",r.products),r.nextPage&&await t("getCollectionProductPage",{handle:s,cursor:r.nextPage,page:o+1})):console.log("Collection not found for handle: "+s)},async getProduct({state:t,dispatch:e,commit:n,getters:s},a){let o=t.allProducts[a];if((!o||o&&!o.meta)&&(n("setIsLoading",!0),o=await s.apiClient.fetchProduct(a),n("pushToAllProducts",[o]),n("setIsLoading",!1)),o.metafields){e("getProductsByHandle",[...o.metafields.pdp_swatch_products?o.metafields.pdp_swatch_products.split(","):[],...o.metafields.pdp_similar_products?o.metafields.pdp_similar_products.split(","):[]])}},async getProductsByHandle({state:t,commit:e,getters:n},s=[]){const a=s.filter(e=>!t.allProducts[e]);e("pushToAllProducts",await n.apiClient.fetchProductsFromHandles(a))}},mutations:{setIsLoading(t,e){t.isLoading=e},markCollectionAsFullyLoaded(t,e){t.loadedCollections=[...t.loadedCollections,e]},addCollectionProducts(t,{handle:e,collectionResponse:n}){const s=t.collections[e],a=s||n;s&&t.collections[e].products&&n.products&&(a.products=[...s.products,...n.products]),r.default.set(t.collections,e,a)},pushToAllProducts(t,e){e.forEach(e=>{"Stale"!==e&&r.default.set(t.allProducts,e.handle,e)})}}}};return t.CreateStore=(t,e)=>new l.default.store({getters:{domain:t,token:e},modules:p,strict:!1}),t.Modules=p,t}({},Vue,ShopifyBuyClient,axios,Vuex);